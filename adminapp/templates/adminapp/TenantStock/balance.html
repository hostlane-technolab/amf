{% extends 'admin_base.html' %}
{% block title %} Tenant Stock Balance {% endblock %}
{% block content %}

<style>
  /* Main Container */
  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
  }

  /* Page Header */
  .page-header {
    margin-bottom: 30px;
  }

  .page-header h3 {
    color: #2c3e50;
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .page-header h3 i {
    color: #3498db;
    font-size: 30px;
  }

  /* Card Styling */
  .card {
    border-radius: 20px;
    background: #ffffff;
    box-shadow: 0 10px 40px rgba(0,0,0,0.08);
    border: none;
    margin-bottom: 25px;
  }

  /* Header Styling */
  .card-header {
    border-radius: 20px 20px 0 0;
    background: linear-gradient(135deg, #f8f9fd 0%, #ffffff 100%);
    border-bottom: 2px solid #f1f3f7;
    padding: 30px;
  }

  .header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
  }

  .header-info {
    display: flex;
    align-items: center;
  }

  .icon-wrapper {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 24px;
    box-shadow: 0 8px 25px rgba(52, 152, 219, 0.2);
    margin-right: 20px;
  }

  .header-text h3 {
    font-size: 24px;
    color: #2c3e50;
    margin: 0 0 5px 0;
  }

  .header-text p {
    color: #6c757d;
    margin: 0;
    font-size: 14px;
  }

  /* Controls Section */
  .controls-section {
    display: flex;
    align-items: center;
    gap: 15px;
    flex-wrap: wrap;
  }

  /* Action Buttons */
  .btn-primary-custom {
    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    color: white;
    padding: 10px 18px;
    text-decoration: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 13px;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    border: none;
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
  }

  .btn-primary-custom:hover {
    background: linear-gradient(135deg, #2980b9 0%, #1f618d 100%);
    color: white;
    text-decoration: none;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
  }

  .btn-success-custom {
    background: linear-gradient(135deg, #28a745 0%, #218838 100%);
    color: white;
    padding: 10px 18px;
    text-decoration: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 13px;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    border: none;
    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
  }

  .btn-success-custom:hover {
    background: linear-gradient(135deg, #218838 0%, #1e7e34 100%);
    color: white;
    text-decoration: none;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
  }

  .btn-info-custom {
    background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
    color: white;
    padding: 10px 18px;
    text-decoration: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 13px;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    border: none;
    box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
  }

  .btn-info-custom:hover {
    background: linear-gradient(135deg, #138496 0%, #117a8b 100%);
    color: white;
    text-decoration: none;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(23, 162, 184, 0.4);
  }

  .btn-warning-custom {
    background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
    color: #212529;
    padding: 10px 18px;
    text-decoration: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 13px;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    border: none;
    box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
  }

  .btn-warning-custom:hover {
    background: linear-gradient(135deg, #e0a800 0%, #d39e00 100%);
    color: #212529;
    text-decoration: none;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 193, 7, 0.4);
  }

  /* Stats Grid */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    padding: 25px 30px;
    background: #f8f9fd;
    border-bottom: 2px solid #f1f3f7;
  }

  .stat-card {
    background: white;
    padding: 25px 20px;
    border-radius: 15px;
    text-align: center;
    border: 2px solid;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s ease;
  }

  .stat-card:hover::before {
    left: 100%;
  }

  .stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.1);
  }

  .stat-card.total-items {
    border-color: rgba(52, 152, 219, 0.2);
    background: linear-gradient(135deg, rgba(52, 152, 219, 0.05) 0%, white 100%);
  }

  .stat-card.active-tenants {
    border-color: rgba(40, 167, 69, 0.2);
    background: linear-gradient(135deg, rgba(40, 167, 69, 0.05) 0%, white 100%);
  }

  .stat-card.low-stock {
    border-color: rgba(255, 193, 7, 0.2);
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.05) 0%, white 100%);
  }

  .stat-card.out-stock {
    border-color: rgba(220, 53, 69, 0.2);
    background: linear-gradient(135deg, rgba(220, 53, 69, 0.05) 0%, white 100%);
  }

  .stat-card .stat-icon {
    font-size: 32px;
    margin-bottom: 15px;
  }

  .stat-card.total-items .stat-icon { color: #3498db; }
  .stat-card.active-tenants .stat-icon { color: #28a745; }
  .stat-card.low-stock .stat-icon { color: #ffc107; }
  .stat-card.out-stock .stat-icon { color: #dc3545; }

  .stat-card h4 {
    margin: 0 0 8px 0;
    color: #6c757d;
    font-size: 13px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .stat-card .value {
    font-size: 28px;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 0;
  }

  .stat-card.total-items .value { color: #3498db; }
  .stat-card.active-tenants .value { color: #28a745; }
  .stat-card.low-stock .value { color: #ffc107; }
  .stat-card.out-stock .value { color: #dc3545; }

  /* Filters Section */
  .filters-section {
    padding: 25px 30px;
    background: linear-gradient(135deg, #f8f9fd 0%, #ffffff 100%);
    border-bottom: 2px solid #f1f3f7;
  }

  .filters-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
  }

  .filter-group {
    position: relative;
  }

  .filter-label {
    font-size: 12px;
    font-weight: 600;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 8px;
    display: block;
  }

  .filter-select, .filter-input {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 500;
    background: white;
    transition: all 0.3s ease;
    outline: none;
  }

  .filter-select:focus, .filter-input:focus {
    border-color: #3498db;
    box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.1);
  }

  /* Export Buttons */
  .export-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
  }

  .export-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .export-btn {
    background: white;
    border: 2px solid #e9ecef;
    color: #6c757d;
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
  }

  .export-btn:hover {
    border-color: #3498db;
    color: #3498db;
    background: rgba(52, 152, 219, 0.05);
  }

  .record-count {
    color: #6c757d;
    font-size: 13px;
    font-weight: 500;
  }

  /* Stock Table */
  .stock-table-wrapper {
    padding: 30px;
    background: white;
  }

  .stock-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    font-size: 14px;
  }

  .stock-table thead th {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    color: white;
    padding: 18px 15px;
    font-weight: 700;
    text-align: left;
    border: none;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .stock-table thead th:first-child {
    border-radius: 15px 0 0 0;
  }

  .stock-table thead th:last-child {
    border-radius: 0 15px 0 0;
  }

  .stock-table tbody tr {
    transition: all 0.3s ease;
    border-bottom: 1px solid #f1f3f7;
  }

  .stock-table tbody tr:hover {
    background: linear-gradient(135deg, #f8f9fd 0%, #ffffff 100%);
    transform: translateX(2px);
  }

  .stock-table tbody td {
    padding: 20px 15px;
    vertical-align: middle;
    border: none;
  }

  /* Tenant Info */
  .tenant-info {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .tenant-avatar-small {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 16px;
  }

  .tenant-details .tenant-name {
    font-weight: 700;
    color: #2c3e50;
    font-size: 15px;
    margin-bottom: 2px;
  }

  .tenant-details .store-info {
    color: #6c757d;
    font-size: 12px;
    font-weight: 500;
  }

  /* Item Details */
  .item-details .item-name {
    font-weight: 600;
    color: #2c3e50;
    font-size: 14px;
    margin-bottom: 3px;
  }

  .item-details .species-info {
    color: #6c757d;
    font-size: 12px;
    margin-bottom: 5px;
  }

  .grade-badge {
    background: #f8f9fa;
    color: #495057;
    padding: 4px 10px;
    border-radius: 8px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* Stock Badges */
  .stock-column {
    text-align: center;
  }

  .stock-badges {
    display: flex;
    flex-direction: column;
    gap: 6px;
    align-items: center;
  }

  .stock-badge {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    min-width: 80px;
    justify-content: center;
  }

  .badge-info { 
    background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); 
    color: white; 
  }
  
  .badge-primary { 
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); 
    color: white; 
  }
  
  .badge-dark { 
    background: linear-gradient(135deg, #343a40 0%, #1d2124 100%); 
    color: white; 
  }
  
  .badge-danger { 
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); 
    color: white; 
  }
  
  .badge-success { 
    background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%); 
    color: white; 
  }

  /* Balance Cell */
  .balance-cell {
    background: linear-gradient(135deg, rgba(40, 167, 69, 0.05) 0%, rgba(40, 167, 69, 0.02) 100%);
    border-left: 4px solid #28a745;
    text-align: center;
  }

  .balance-cell.low-stock {
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.05) 0%, rgba(255, 193, 7, 0.02) 100%);
    border-left-color: #ffc107;
  }

  .balance-cell.out-of-stock {
    background: linear-gradient(135deg, rgba(220, 53, 69, 0.05) 0%, rgba(220, 53, 69, 0.02) 100%);
    border-left-color: #dc3545;
  }

  .stock-alert {
    margin-top: 8px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
  }

  .stock-alert.danger { color: #dc3545; }
  .stock-alert.warning { color: #ffc107; }

  /* Action Buttons */
  .action-buttons {
    display: flex;
    gap: 5px;
    justify-content: center;
  }

  .action-btn {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    border: 2px solid #e9ecef;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    cursor: pointer;
    font-size: 12px;
  }

  .action-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  .action-btn.view {
    color: #3498db;
    border-color: rgba(52, 152, 219, 0.3);
  }

  .action-btn.view:hover {
    background: #3498db;
    color: white;
  }

  .action-btn.edit {
    color: #17a2b8;
    border-color: rgba(23, 162, 184, 0.3);
  }

  .action-btn.edit:hover {
    background: #17a2b8;
    color: white;
  }

  .action-btn.add {
    color: #28a745;
    border-color: rgba(40, 167, 69, 0.3);
  }

  .action-btn.add:hover {
    background: #28a745;
    color: white;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 80px 20px;
    background: linear-gradient(135deg, #f8f9fd 0%, #ffffff 100%);
  }

  .empty-state-icon {
    font-size: 72px;
    color: #3498db;
    margin-bottom: 25px;
    opacity: 0.8;
  }

  .empty-state h4 {
    color: #2c3e50;
    margin-bottom: 12px;
    font-weight: 700;
    font-size: 24px;
  }

  .empty-state p {
    color: #6c757d;
    margin-bottom: 30px;
    font-size: 16px;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .container {
      padding: 15px;
    }
    
    .header-content {
      flex-direction: column;
      align-items: stretch;
    }
    
    .controls-section {
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .stats-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
    
    .filters-row {
      grid-template-columns: 1fr;
      gap: 15px;
    }
    
    .export-section {
      flex-direction: column;
      align-items: stretch;
    }
    
    .stock-table-wrapper {
      padding: 20px;
      overflow-x: auto;
    }
    
    .tenant-info {
      flex-direction: column;
      text-align: center;
      gap: 8px;
    }
  }

  @media (max-width: 576px) {
    .stats-grid {
      grid-template-columns: 1fr;
    }
    
    .export-buttons {
      width: 100%;
      justify-content: center;
    }
    
    .action-buttons {
      flex-direction: column;
    }
    
    .stock-badges {
      gap: 4px;
    }
    
    .stock-badge {
      font-size: 10px;
      padding: 4px 8px;
      min-width: 70px;
    }
  }
</style>

<div class="container">
  <div class="page-inner">
    <div class="page-header">
      <h3 class="fw-bold">
        <i class="fas fa-balance-scale"></i>
        Stock Balance Management
      </h3>
    </div>

    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <div class="header-content">
              <div class="header-info">
                <div class="icon-wrapper">
                  <i class="fas fa-warehouse"></i>
                </div>
                <div class="header-text">
                  <h3>Tenant Stock Balance</h3>
                  <p>Comprehensive stock management dashboard</p>
                </div>
              </div>
              
              <div class="controls-section">
                <a href="{% url 'adminapp:tenant_stock_summary' %}" class="btn-info-custom">
                  <i class="fas fa-chart-pie"></i>Summary View
                </a>
                <a href="{% url 'adminapp:list_freezing_entry_tenant' %}" class="btn-primary-custom">
                  <i class="fas fa-snowflake"></i>Freezing Entries
                </a>
                <a href="{% url 'adminapp:list_return_tenant' %}" class="btn-warning-custom">
                  <i class="fas fa-undo"></i>Return Entries
                </a>
                <a href="{% url 'adminapp:create_freezing_entry_tenant' %}" class="btn-success-custom">
                  <i class="fas fa-plus"></i>Add Entry
                </a>
              </div>
            </div>
          </div>
          
          <!-- Summary Stats -->
          <div class="stats-grid">
            <div class="stat-card total-items">
              <div class="stat-icon">
                <i class="fas fa-boxes"></i>
              </div>
              <h4>Total Items</h4>
              <div class="value">{{ total_items|default:0 }}</div>
            </div>
            <div class="stat-card active-tenants">
              <div class="stat-icon">
                <i class="fas fa-users"></i>
              </div>
              <h4>Active Tenants</h4>
              <div class="value">{{ total_tenants|default:0 }}</div>
            </div>
            <div class="stat-card low-stock">
              <div class="stat-icon">
                <i class="fas fa-exclamation-triangle"></i>
              </div>
              <h4>Low Stock Items</h4>
              <div class="value">{{ low_stock_count|default:0 }}</div>
            </div>
            <div class="stat-card out-stock">
              <div class="stat-icon">
                <i class="fas fa-times-circle"></i>
              </div>
              <h4>Out of Stock</h4>
              <div class="value">{{ out_of_stock_count|default:0 }}</div>
            </div>
          </div>

          <!-- Filters Section -->
          <div class="filters-section">
            <div class="filters-row">
              <div class="filter-group">
                <label class="filter-label">Filter by Tenant</label>
                <select class="filter-select" id="tenantFilter">
                  <option value="">All Tenants</option>
                  {% for tenant in tenants %}
                  <option value="{{ tenant.name }}">{{ tenant.name }}</option>
                  {% endfor %}
                </select>
              </div>
              
              <div class="filter-group">
                <label class="filter-label">Filter by Species</label>
                <select class="filter-select" id="speciesFilter">
                  <option value="">All Species</option>
                  {% for species in species_list %}
                  <option value="{{ species }}">{{ species }}</option>
                  {% endfor %}
                </select>
              </div>
              
              <div class="filter-group">
                <label class="filter-label">Stock Status</label>
                <select class="filter-select" id="stockStatusFilter">
                  <option value="">All Status</option>
                  <option value="in-stock">In Stock</option>
                  <option value="low-stock">Low Stock</option>
                  <option value="out-of-stock">Out of Stock</option>
                </select>
              </div>
              
              <div class="filter-group">
                <label class="filter-label">Quick Search</label>
                <input type="text" class="filter-input" id="quickSearch" 
                       placeholder="Search items, grades...">
              </div>
            </div>

            <div class="export-section">
              <div class="export-buttons">
                <button class="export-btn" id="exportExcel">
                  <i class="fas fa-file-excel"></i>Export Excel
                </button>
                <button class="export-btn" id="exportPDF">
                  <i class="fas fa-file-pdf"></i>Export PDF
                </button>
                <button class="export-btn" id="printTable">
                  <i class="fas fa-print"></i>Print
                </button>
              </div>
              <div class="record-count">
                <i class="fas fa-info-circle"></i>
                Showing <span id="recordsCount">{{ total_items }}</span> items with remaining stock
              </div>
            </div>
          </div>

          <!-- Stock Table -->
          {% if stock_balance %}
          <div class="stock-table-wrapper">
            <table class="stock-table" id="stockTable">
              <thead>
                <tr>
                  <th>
                    <i class="fas fa-user"></i> Tenant
                  </th>
                  <th>
                    <i class="fas fa-box"></i> Item Details
                  </th>
                  <th class="stock-column">
                    <i class="fas fa-arrow-down"></i> Stock In
                  </th>
                  <th class="stock-column">
                    <i class="fas fa-arrow-up"></i> Returned
                  </th>
                  <th class="stock-column">
                    <i class="fas fa-balance-scale"></i> Current Balance
                  </th>
                  <th class="stock-column">Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for item in stock_balance %}
                <tr data-tenant="{{ item.tenant_name }}" 
                    data-species="{{ item.species }}"
                    data-stock-status="{% if item.kg_balance <= 0 %}out-of-stock{% elif item.kg_balance < 10 %}low-stock{% else %}in-stock{% endif %}">
                  
                  <!-- Tenant Column -->
                  <td>
                    <div class="tenant-info">
                      <div class="tenant-avatar-small">
                        <i class="fas fa-industry"></i>
                      </div>
                      <div class="tenant-details">
                        <div class="tenant-name">{{ item.tenant_name }}</div>
                        <div class="store-info">
                          <i class="fas fa-store"></i> {{ item.store|default:"No Store" }}
                        </div>
                      </div>
                    </div>
                  </td>
                  
                  <!-- Item Details Column -->
                  <td>
                    <div class="item-details">
                      <div class="item-name">{{ item.item_name }}</div>
                      <div class="species-info">
                        <i class="fas fa-fish"></i> {{ item.species }}
                      </div>
                      <span class="grade-badge">Grade: {{ item.grade|default:"N/A" }}</span>
                    </div>
                  </td>
                  
                  <!-- Stock In Column -->
                  <td class="stock-column">
                    <div class="stock-badges">
                      <span class="stock-badge badge-info">
                        <i class="fas fa-layer-group"></i> {{ item.slab_in|default:0 }} Slab
                      </span>
                      <span class="stock-badge badge-primary">
                        <i class="fas fa-box"></i> {{ item.cs_in|default:0 }} C/S
                      </span>
                      <span class="stock-badge badge-dark">
                        <i class="fas fa-weight"></i> {{ item.kg_in|default:0 }} KG
                      </span>
                    </div>
                  </td>
                  
                  <!-- Returned Column -->
                  <td class="stock-column">
                    <div class="stock-badges">
                      <span class="stock-badge badge-danger">
                        <i class="fas fa-layer-group"></i> {{ item.slab_out|default:0 }} Slab
                      </span>
                      <span class="stock-badge badge-danger">
                        <i class="fas fa-box"></i> {{ item.cs_out|default:0 }} C/S
                      </span>
                      <span class="stock-badge badge-danger">
                        <i class="fas fa-weight"></i> {{ item.kg_out|default:0 }} KG
                      </span>
                    </div>
                  </td>
                  
                  <!-- Balance Column -->
                  <td class="balance-cell {% if item.kg_balance <= 0 %}out-of-stock{% elif item.kg_balance < 10 %}low-stock{% endif %}">
                    <div class="stock-badges">
                      <span class="stock-badge badge-success">
                        <i class="fas fa-layer-group"></i> {{ item.slab_balance|default:0 }} Slab
                      </span>
                      <span class="stock-badge badge-success">
                        <i class="fas fa-box"></i> {{ item.cs_balance|default:0 }} C/S
                      </span>
                      <span class="stock-badge badge-success" style="font-weight: 800;">
                        <i class="fas fa-weight"></i> {{ item.kg_balance|default:0 }} KG
                      </span>
                    </div>
                    {% if item.kg_balance <= 0 %}
                    <div class="stock-alert danger">
                      <i class="fas fa-exclamation-triangle"></i> Out of Stock
                    </div>
                    {% elif item.kg_balance < 10 %}
                    <div class="stock-alert warning">
                      <i class="fas fa-exclamation-triangle"></i> Low Stock
                    </div>
                    {% endif %}
                  </td>
                  
                  <!-- Actions Column -->
                  <td class="stock-column">
                    <div class="action-buttons">
                      <a href="{% url 'adminapp:tenant_stock_detail' item.tenant_id %}" 
                         class="action-btn view" 
                         title="View Details">
                        <i class="fas fa-eye"></i>
                      </a>
                      <a href="#" 
                         class="action-btn edit" 
                         title="Edit Stock">
                        <i class="fas fa-edit"></i>
                      </a>
                      <button class="action-btn add" 
                              title="Add Return Entry"
                              onclick="openReturnModal('{{ item.tenant_id }}', '{{ item.item_name }}')">
                        <i class="fas fa-plus"></i>
                      </button>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <!-- Empty State -->
          <div class="empty-state">
            <div class="empty-state-icon">
              <i class="fas fa-boxes"></i>
            </div>
            <h4>No Stock Data Available</h4>
            <p>There are no tenant stock entries to display at the moment.</p>
            <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
              <a href="{% url 'adminapp:create_freezing_entry_tenant' %}" class="btn-primary-custom">
                <i class="fas fa-plus"></i>Add Freezing Entry
              </a>
              <a href="{% url 'adminapp:tenant_stock_summary' %}" class="btn-info-custom">
                <i class="fas fa-chart-pie"></i>View Summary
              </a>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize filter functionality
    const tenantFilter = document.getElementById('tenantFilter');
    const speciesFilter = document.getElementById('speciesFilter');
    const stockStatusFilter = document.getElementById('stockStatusFilter');
    const quickSearch = document.getElementById('quickSearch');
    const recordsCount = document.getElementById('recordsCount');
    const stockTable = document.getElementById('stockTable');
    const allRows = stockTable ? stockTable.querySelectorAll('tbody tr') : [];
    const totalCount = allRows.length;

    // Update record count and stats
    function updateStats() {
        const visibleRows = document.querySelectorAll('#stockTable tbody tr[style=""], #stockTable tbody tr:not([style*="display: none"])');
        let visibleCount = 0;
        let lowStockCount = 0;
        let outOfStockCount = 0;

        visibleRows.forEach(row => {
            visibleCount++;
            const stockStatus = row.getAttribute('data-stock-status');
            if (stockStatus === 'low-stock') lowStockCount++;
            if (stockStatus === 'out-of-stock') outOfStockCount++;
        });

        if (recordsCount) {
            recordsCount.textContent = visibleCount;
        }

        // Update stats cards if they exist
        const lowStockCard = document.querySelector('.stat-card.low-stock .value');
        const outStockCard = document.querySelector('.stat-card.out-stock .value');
        const totalItemsCard = document.querySelector('.stat-card.total-items .value');
        
        if (lowStockCard) lowStockCard.textContent = lowStockCount;
        if (outStockCard) outStockCard.textContent = outOfStockCount;
        if (totalItemsCard) totalItemsCard.textContent = visibleCount;
    }

    // Filter function
    function applyFilters() {
        if (!stockTable) return;
        
        const tenantValue = tenantFilter?.value.toLowerCase() || '';
        const speciesValue = speciesFilter?.value.toLowerCase() || '';
        const statusValue = stockStatusFilter?.value || '';
        const searchValue = quickSearch?.value.toLowerCase().trim() || '';

        allRows.forEach(row => {
            let showRow = true;
            
            const tenantName = row.getAttribute('data-tenant')?.toLowerCase() || '';
            const species = row.getAttribute('data-species')?.toLowerCase() || '';
            const stockStatus = row.getAttribute('data-stock-status') || '';
            const rowText = row.textContent.toLowerCase();

            // Apply filters
            if (tenantValue && !tenantName.includes(tenantValue)) showRow = false;
            if (speciesValue && !species.includes(speciesValue)) showRow = false;
            if (statusValue && stockStatus !== statusValue) showRow = false;
            if (searchValue && !rowText.includes(searchValue)) showRow = false;

            row.style.display = showRow ? '' : 'none';
        });

        updateStats();
    }

    // Event listeners for filters
    if (tenantFilter) tenantFilter.addEventListener('change', applyFilters);
    if (speciesFilter) speciesFilter.addEventListener('change', applyFilters);
    if (stockStatusFilter) stockStatusFilter.addEventListener('change', applyFilters);
    if (quickSearch) {
        quickSearch.addEventListener('input', applyFilters);
        quickSearch.addEventListener('keyup', function(e) {
            if (e.key === 'Escape') {
                quickSearch.value = '';
                applyFilters();
                quickSearch.focus();
            }
        });
    }

    // Export functionality
    const exportExcel = document.getElementById('exportExcel');
    const exportPDF = document.getElementById('exportPDF');
    const printTable = document.getElementById('printTable');

    if (exportExcel) {
        exportExcel.addEventListener('click', function() {
            // Add loading state
            const originalText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>Exporting...';
            
            setTimeout(() => {
                this.innerHTML = originalText;
                alert('Excel export functionality to be implemented');
            }, 2000);
        });
    }

    if (exportPDF) {
        exportPDF.addEventListener('click', function() {
            const originalText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>Generating...';
            
            setTimeout(() => {
                this.innerHTML = originalText;
                alert('PDF export functionality to be implemented');
            }, 2000);
        });
    }

    if (printTable) {
        printTable.addEventListener('click', function() {
            window.print();
        });
    }

    // Add smooth animations to table rows
    allRows.forEach((row, index) => {
        row.style.animationDelay = `${index * 0.05}s`;
        row.style.animation = 'fadeInUp 0.6s ease forwards';
    });

    // Add loading states for action buttons
    document.querySelectorAll('.action-btn, .btn-primary-custom, .btn-success-custom, .btn-info-custom, .btn-warning-custom').forEach(btn => {
        btn.addEventListener('click', function(e) {
            if (this.tagName === 'BUTTON' && !this.onclick) return;
            
            const icon = this.querySelector('i');
            if (icon && !icon.classList.contains('fa-spinner')) {
                const originalClass = icon.className;
                icon.className = 'fas fa-spinner fa-spin';
                
                setTimeout(() => {
                    if (icon) icon.className = originalClass;
                }, 1500);
            }
        });
    });

    // Initialize tooltips for action buttons
    document.querySelectorAll('.action-btn').forEach(btn => {
        btn.addEventListener('mouseenter', function() {
            const title = this.getAttribute('title');
            if (title) {
                // Simple tooltip implementation
                const tooltip = document.createElement('div');
                tooltip.className = 'custom-tooltip';
                tooltip.textContent = title;
                tooltip.style.cssText = `
                    position: absolute;
                    background: #2c3e50;
                    color: white;
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-size: 11px;
                    z-index: 1000;
                    pointer-events: none;
                    white-space: nowrap;
                `;
                document.body.appendChild(tooltip);
                
                const rect = this.getBoundingClientRect();
                tooltip.style.top = (rect.top - tooltip.offsetHeight - 5) + 'px';
                tooltip.style.left = (rect.left + rect.width/2 - tooltip.offsetWidth/2) + 'px';
                
                this._tooltip = tooltip;
            }
        });
        
        btn.addEventListener('mouseleave', function() {
            if (this._tooltip) {
                document.body.removeChild(this._tooltip);
                this._tooltip = null;
            }
        });
    });

    // Initialize with current stats
    updateStats();
});

// Function to open return modal
function openReturnModal(tenantId, itemName) {
    // This would typically open a modal dialog
    alert(`Opening return entry for Tenant ID: ${tenantId}, Item: ${itemName}\n\nThis functionality needs to be implemented with your modal system.`);
}

// Animation keyframes
const style = document.createElement('style');
style.textContent = `
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .custom-tooltip {
    animation: tooltipFadeIn 0.2s ease;
  }
  
  @keyframes tooltipFadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
  }
`;
document.head.appendChild(style);
</script>

{% endblock %}